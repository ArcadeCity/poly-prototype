<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/ipfs-upload/ipfs-upload.html">
<link rel="import" href="../bower_components/ac-style/ac-style.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="./ac-sizeview.html">

<link rel="import" href="my-icons.html">

<dom-module id="ac-app">
  <template>
    <style>
      :host {
/*        --app-primary-color: #4285f4;
        --app-secondary-color: black;

        display: block;*/
      }
/*
      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
      }
      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      .drawer-list {
      }

      .drawer-list a {
      }

      .drawer-list a.iron-selected {
        color: black;
        font-weight: bold;
      }

      .topbar {
    width: 100%;
    @apply(--base-structure);
    height: var(--topbar-height);
    @apply(--layout-horizontal);
    @apply(--layout-center);
    box-sizing: border-box;
    padding: 10px 20px 10px 20px;
  }


  .container {
    width: 100%;
    @apply(--layout-vertical);
    @apply(--layout-center);
    @apply(--layout-start-justified);
    background-color: white;
  }

  .main {
    width: 100%;
    max-width: 90vw;
    @apply(--layout-horizontal);
    @apply(--layout-wrap);
    display: var(--main-display);

  }

  .avatararea {
  width: var(--avatararea-width);
  @apply(--layout-horizontal);
  @apply(--layout-start);
  @apply(--layout-center-justified);
  box-sizing: border-box;
  padding: 0px;
  margin: 0px 0px 10px 0px;
}

.totalinfo {
  width: var(--totalinfo-width);
  @apply(--layout-flex);
  @apply(--layout-vertical);
  @apply(--layout-start);
  @apply(--layout-center-justified);
}

.avatarbg {
  width: var(--avatarbg-size);
  height: var(--avatarbg-size);
  margin: var(--avatararea-margin);
  border-radius: 50%;
  background-position: center;
  background: url(../../images/locals-bg3.png);
  background-size: var(--bg-size);
}


.menuicon {
  cursor: pointer;
  height: 60px;
  width: 60px;
  @apply(--layout-horizontal);
  @apply(--layout-center-center);
}*/

    </style>

    <app-location route="{{route}}"></app-location>

    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>

    <app-route
        route="{{subroute}}"
        data="{{subrouteData}}"
        pattern="/:key"></app-route>

<!--     <app-drawer-layout fullbleed force-narrow>
      <app-drawer id="drawer" swipe-open>
        <app-toolbar>Menu</app-toolbar>
        <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
          <a name="profile" href="/profile">Profile</a>
          <a name="wallet" href="/wallet">Wallet</a>
          <a name="settings" href="/settings">Settings</a>
          <a name="list" href="/list">List</a>
          <a name="map" href="/map">Map</a>
        </iron-selector>
      </app-drawer> -->

<!--       <app-header-layout has-scrolling-region>

        <div class="topbar">
        <div class="menuicon">
        <ac-icon icon="ac-brandlogo-color" big on-tap="firetoggle"></ac-icon>
        </div>

        <div class="userinfo" on-tap="toProfile">
           <div class="avatar" id="avatar">
            <img src="{{_getipfsurl(userdata.avatar)}}" observe="userdata.avatar">
          </div>
          <p class="username">{{userdata.username}}</p>
        </div>

        <p class="flex"></p>

      </div>

        </div>
 -->
        <iron-pages
            selected="[[page]]"
            attr-for-selected="name"
            fallback-selection="view404"
            role="main">

            <ac-newuser name="newuser" sizeview="{{sizeview}}"></ac-newuser>
            <ac-password name="password" sizeview="{{sizeview}}"></ac-password>

            <ac-map name="map" sizeview="{{sizeview}}"></ac-map>
            <ac-list name="list" sizeview="{{sizeview}}"></ac-list>

            <ac-detail name="detail" key="[[subrouteData.key]]" sizeview="{{sizeview}}"></ac-detail>

            <ac-myitems name="myitems" sizeview="{{sizeview}}"></ac-myitems>
            <ac-myitem name="myitem" key="[[key]]" sizeview="{{sizeview}}"></ac-myitem>

            <ac-newoffer name="newoffer" sizeview="{{sizeview}}"></ac-newoffer>

            <ac-profile name="profile" account="[[account]]" sizeview="{{sizeview}}"></ac-profile>
            <ac-wallet name="wallet" account="[[account]]" balance="[[balance]]" sizeview="{{sizeview}}"></ac-wallet>

            <ac-settings name="settings" sizeview="{{sizeview}}"></ac-settings>

            <ac-view404 name="view404" sizeview="{{sizeview}}"></ac-view404>

        </iron-pages>
<!--       </app-header-layout>
    </app-drawer-layout> -->

    <ac-sizeview sizeview="{{sizeview}}"></ac-sizeview>

    <ipfs-upload host="ipfs.arcadecity.world" id="ipfsupload" ipfs="{{ipfs}}" hidefileinput></ipfsupload>

  </template>

  <script>
    Polymer({
      is: 'ac-app',

      properties: {
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        }
      },

      observers: [
        '_routePageChanged(routeData.page)'
      ],

      attached: function() {
        if(localStorage.getItem("ac-user")){
          if(sessionStorage.getItem("ac-password", this.password)){
            app.set('route.path', '/map/');
          } else {
            app.set('route.path', '/password/');
          }
        } else {
          app.set('route.path', '/newuser/');
        }
      },

      _routePageChanged: function(page) {
        this.page = page || 'map';
      },

      _pageChanged: function(page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl('ac-' + page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function() {
        this.page = 'view404';
      },

      firetoggle: function(){
        this.$.drawer.toggle();
      },

      _getipfsurl: function(hash) {
          if(this.$.ipfsupload){
           var url = this.$.ipfsupload.url(hash);
           return url;
         }
        },
    });
  </script>
  <script src="scripts/helpers.js"></script>
  <script src="../bower_components/geohash-js/geohash.js" type="text/javascript"></script>

</dom-module>
