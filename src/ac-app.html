<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/ac-style/ac-style.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="./ac-sizeview.html">
<link rel="import" href="./ac-locationpicker.html">
<link rel="import" href="./ac-locationtracker.html">
<link rel="import" href="./ac-profile.html">
<link rel="import" href="./ac-list.html">
<link rel="import" href="./ac-myitem.html">
<link rel="import" href="./ac-myitems.html">
<link rel="import" href="./ac-newuser.html">
<link rel="import" href="./ac-map.html">
<link rel="import" href="./ac-detail.html">
<link rel="import" href="./ac-ipfsupload.html">
<link rel="import" href="./ac-wallet.html">
<link rel="import" href="./ac-settings.html">
<link rel="import" href="./ac-view404.html">
<link rel="import" href="./ac-transact.html">
<link rel="import" href="./ac-password.html">

<dom-module id="ac-app">
  <template>
    <style>
      :host {
      --app-drawer-width: 290px;
      }

      #drawer {
        z-index: 99;
      }

      .drawercontent {
        height: 100%;
        background-color: var(--ac-yellow);
        @apply(--layout-vertical);
        @apply(--layout-center-center);
      }


    </style>
<app-drawer-layout force-narrow>
  <app-drawer align="right" id="drawer">
    <div class="drawercontent">
    <h1>here be filters</h1>
    </div>
  </app-drawer>

    <app-location route="{{route}}"></app-location>


    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>

    <app-route
        route="{{subroute}}"
        data="{{subrouteData}}"
        pattern="/:key"></app-route>

 <ac-blockdata blockdata="{{blockdata}}"></ac-blockdata>

<!--  <h1>OFFERS</h1>
<template is="dom-repeat" items="{{blockdata}}">
  <p>Block</p>
  <p>{{item.offerid}}</p>
</template> -->




         <iron-pages
            selected="[[page]]"
            attr-for-selected="name"
            fallback-selection="view404"
            role="main">

            <ac-newuser name="newuser"></ac-newuser>
            <ac-password name="password"></ac-password>

            <ac-map name="map" blockdata="[[blockdata]]" latitude="{{latitude}}" longitude="{{longitude}}" restamp on-to-filter="firetoggle"></ac-map>
             <ac-list name="list" restamp blockdata="[[blockdata]]" on-to-filter="firetoggle"></ac-list>

            <ac-detail name="detail" id="detail" blockdata="[[blockdata]]" key="[[subrouteData.key]]" restamp></ac-detail>

            <ac-myitems name="myitems" blockdata="[[blockdata]]" restamp></ac-myitems>
            <ac-myitem name="myitem" blockdata="[[blockdata]]" key="[[key]]" restamp></ac-myitem>

            <ac-newoffer latitude="{{latitude}}" longitude="{{longitude}}" name="newoffer" restamp></ac-newoffer>

            <ac-profile name="profile" account="[[account]]" restamp></ac-profile>
            <ac-wallet id="acwallet" name="wallet" account="{{account}}" balance="{{balance}}" restamp></ac-wallet>

            <ac-settings name="settings" restamp></ac-settings>

            <ac-view404 name="view404" restamp></ac-view404>

<!--             <ac-locationpicker name="locationpicker" sizeview="{{sizeview}}" restamp></ac-locationpicker>
 -->
       </iron-pages>

    <ac-sizeview sizeview="{{sizeview}}"></ac-sizeview>

    <ac-transact on-txhash="" on-mined="" on-error="" id="transact"></ac-transact>


</app-drawer-layout>
    <!-- location tracker -->
    <!-- <template is="dom-if" if="{{online}}" restamp>
      <ac-password name="password"></ac-password>
      <ac-locationtracker
        id="locationtracker"
        online="{{online}}"
        on-location-changed="locationchanged"
      ></ac-locationtracker>
    </template> -->





  </template>

  <script>

    Polymer({
      is: 'ac-app',

      properties: {
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        },
        route: {
          type: String,
          observer: '_route'
        },
        online:{
          type: Boolean
        }
      },

      observers: [
        '_routePageChanged(routeData.page)'
      ],

      attached: function() {

        window.app = this;

        this.fire('map-update');

        app.set('route.path', '/map');

        // if(localStorage.getItem("ac-user")){
        //   if(sessionStorage.getItem("ac-password", this.password)){
        //     app.set('route.path', localStorage.getItem('ac-lastroute'));
        //     this.fire('map-update');
        //   } else {
        //     app.set('route.path', '/password/');
        //   }
        // } else {
        //   app.set('route.path', '/newuser/');
        // }

        // debug code - remove me..
        // var self= this;
        // setInterval(function(){
        //   console.log('setting online to true');
        //   self.online = !self.online;
        // },15*1000);

      },

      _routePageChanged: function(page) {
        this.page = page || 'map';
        this.fire('map-update');
      },

      _pageChanged: function(page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl('ac-' + page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function() {
        this.page = 'view404';
      },

      firetoggle: function(){
        this.$.drawer.toggle();
      },

      // _getipfsurl: function(hash) {
      //     if(this.$.ipfsupload){
      //      var url = this.$.ipfsupload.url(hash);
      //      return url;
      //    }
      // },

      _route: function() {
        localStorage.setItem('ac-lastroute', this.route.path);
        this.fire('map-update');
      }
    });
  </script>
  <script src="../bower_components/geohash-js/geohash.js" type="text/javascript"></script>
</dom-module>
